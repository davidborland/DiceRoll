<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Dice Roller</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
</head>

<body>

<div class="jumbotron text-center">
  <h1>Dice Roll</h1>
</div>

<div class="container-fluid text-center" style="width: 1200px">
  <div class="row">
    <div class="col-2">
      <div>
        <h3>Controls</h3>
        <div class="form-group text-left">
          <label for="typeSelect">Type</label>
          <select class="form-control" id="typeSelect">
            <option value="2">Coin flip</option>
            <option value="4">4-sided</option>
            <option value="6">6-sided</option>
            <option value="8">8-sided</option>
            <option value="10">10-sided</option>
            <option value="12">12-sided</option>
            <option value="20">20-sided</option>
          </select>
          <label class="mt-3" for="numberSelect">Number</label>
          <select class="form-control" id="numberSelect">
            <option value="1">1</option>
            <option value="2">2</option>
          </select>
        </div>
        <button type="button" class="btn btn-secondary form-control mt-1" id="rollButton">Roll!</button>
      </div>
    </div>
    <div class="col-8">
      <h3>Result</h3>
      <div id="result" class="row mt-5"></div>
    </div>
  </div>
  <div class="row"></div>
    <div class="col text-right small mt-5">
        <div>Author: David Borland, RENCI, UNC-Chapel Hill</div>
        <div><a href="https://github.com/davidborland/DiceRoll">GitHub repository</a></div>
      </div>
    </div>
  </div>  
</div>

<script type="text/javascript">

// Edit shape
let diceType = 2;
let diceNumber = 1;

// Shape select
d3.select("#typeSelect").on("change", () => {
  diceType = +d3.event.target.value;
});

// Number select
d3.select("#numberSelect").on("change", () => {
  diceNumber = +d3.event.target.value;
});

// Roll
d3.select("#rollButton").on("click", roll);

const randomInt = (min, max) => {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function roll() {
  d3.select("#typeSelect").property("disabled", true);
  d3.select("#numberSelect").property("disabled", true);
  d3.select("#rollButton").property("disabled", true);

  const rollTime = 3000;
  const rollIncrement = 10;

  let time = 0;
  const timer = setInterval(() => {
    const dice = d3.range(0, diceNumber).map(() => {
      return randomInt(1, diceType);
    });

    const div = d3.select("#result").selectAll("div")
        .data(dice);

    const divEnter = div.enter().append("div")
        .attr("class", "col")

    divEnter.append("h1")
        .attr("class", "display-1");

    divEnter.merge(div).select("h1")
        .text(d => diceType === 2 ? d === 1 ? "Tails" : "Heads" : d);

    div.exit().remove();

    time += rollIncrement;
    
    if (time >= rollTime) { 
      d3.select("#typeSelect").property("disabled", false);
      d3.select("#numberSelect").property("disabled", false);
      d3.select("#rollButton").property("disabled", false);

      clearInterval(timer);
    }
  }, rollIncrement);

}

</script>

</body>